<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dipin's Dreamy Garden</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Plus+Jakarta+Sans:wght@300;600&display=swap');
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #0a0510; color: white; 
            font-family: 'Plus Jakarta Sans', sans-serif;
            touch-action: none; /* Prevents mobile bounce/scroll */
        }
        
        #three-container { position: fixed; inset: 0; display: none; z-index: 10; background: radial-gradient(circle at center, #2d1b4e 0%, #000 100%); }
        
        #start-screen, #reveal-screen { 
            position: fixed; inset: 0; z-index: 1000; 
            background: radial-gradient(circle at bottom, #4c1d95 0%, #0a0510 100%);
            display: flex; flex-direction: column; items: center; justify-content: center; 
            padding: 20px;
        }

        .cursive { font-family: 'Dancing Script', cursive; }
        
        #hud { 
            position: fixed; top: 40px; width: 100%; text-align: center; z-index: 500; 
            opacity: 0; pointer-events: none; transition: all 0.8s ease; 
        }

        .bar-bg { 
            width: 80%; max-width: 300px; height: 10px; background: rgba(255,255,255,0.1); 
            border-radius: 20px; margin: 15px auto; overflow: hidden;
            backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2);
        }

        #bar-fill { 
            width: 0%; height: 100%; background: linear-gradient(90deg, #f43f5e, #fb7185); 
            box-shadow: 0 0 20px #f43f5e; transition: width 0.4s ease; 
        }

        #basket { 
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); 
            font-size: 4rem; z-index: 100; pointer-events: none; opacity: 0; 
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
            transition: opacity 0.5s;
        }

        .final-card {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            background: rgba(15, 7, 32, 0.8); backdrop-filter: blur(20px);
            padding: 2rem; border-radius: 2rem; border: 1px solid rgba(251, 191, 36, 0.3);
            text-align: center; opacity: 0; transition: all 2s ease-out; z-index: 2000; 
            pointer-events: none; width: 90vw; max-width: 450px;
            box-shadow: 0 0 100px rgba(244, 63, 94, 0.3);
        }

        .final-card.show { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }

        .user-pic { 
            width: 120px; height: 120px; object-fit: cover; border-radius: 50%; 
            border: 3px solid #fbbf24; margin: 0 auto 1.5rem; 
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.4); 
        }

        #game-canvas { position: fixed; inset: 0; z-index: 50; }

        .score-pop { animation: pop 0.3s ease; }
        @keyframes pop { 50% { transform: scale(1.2); color: #fb7185; } }
        
        .shake { animation: shake 0.4s linear; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>

    <audio id="gameSfx" loop preload="auto"><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg"></audio>
    <audio id="winSong" loop preload="auto"><source src="song.mp3" type="audio/mpeg"></audio>
    <audio id="yay" preload="auto"><source src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3" type="audio/mpeg"></audio>
    <audio id="neh" preload="auto"><source src="https://gfxsounds.com/wp-content/uploads/2023/03/Beep-error.mp3" type="audio/mpeg"></audio>

    <div id="start-screen">
        <h1 class="cursive text-6xl md:text-8xl text-rose-200 mb-6 text-center">Dipin's Garden</h1>
        <button onclick="begin()" class="cursive text-2xl md:text-3xl text-white bg-gradient-to-r from-rose-600 to-rose-400 px-10 py-3 rounded-full hover:scale-105 transition-all">Enter Garden</button>
    </div>

    <div id="reveal-screen" style="display:none;">
        <h2 class="cursive text-5xl text-white mb-8 text-center px-4">You caught them all!</h2>
        <button onclick="bloom()" class="cursive text-4xl text-white bg-gradient-to-r from-amber-600 to-yellow-500 px-12 py-5 rounded-full animate-bounce">Reveal The Garden</button>
    </div>

    <div id="hud">
        <div class="text-rose-100 text-4xl cursive mb-1" id="score-wrapper"><span id="score">0</span> / 20</div>
        <div class="bar-bg"><div id="bar-fill"></div></div>
    </div>

    <div id="basket">ðŸ§º</div>
    <canvas id="game-canvas"></canvas>
    <div id="three-container"></div>

    <div id="final-card" class="final-card">
        <img src="rose.JPG" class="user-pic" alt="Budi">
        <h1 class="cursive text-5xl text-rose-100 mb-4">Happy Rose Day, Budi</h1>
        <p class="text-rose-100 text-lg italic leading-relaxed">
            "Real ma rose dina napayani mailey yo sundar bagaicha banako xu, happy rose day sanu!"
        </p>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const basket = document.getElementById('basket');
        const fill = document.getElementById('bar-fill');
        const scoreWrap = document.getElementById('score-wrapper');
        const gameSfx = document.getElementById('gameSfx');
        const winSong = document.getElementById('winSong');
        
        let audioContext, width, height, score = 0, active = false, items = [], mouseX = 0, mouseY = 0;

        function resize() { 
            width = canvas.width = window.innerWidth; 
            height = canvas.height = window.innerHeight; 
        }
        window.addEventListener('resize', resize); resize();

        async function initAudio() {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            if (audioContext.state === 'suspended') await audioContext.resume();
        }

        // --- CONTROL LOGIC (Mobile + Desktop) ---
        function handleMove(clientX) {
            mouseX = clientX;
            if (active) {
                basket.style.left = clientX + 'px';
            }
        }

        window.addEventListener('mousemove', (e) => handleMove(e.clientX));
        window.addEventListener('touchmove', (e) => {
            handleMove(e.touches[0].clientX);
            if(active) e.preventDefault();
        }, { passive: false });

        async function begin() {
            await initAudio();
            document.getElementById('start-screen').style.display = 'none';
            gameSfx.play().catch(()=>{});
            document.getElementById('hud').style.opacity = '1';
            basket.style.opacity = '1';
            active = true;
            loop();
        }

        class Drop {
            constructor() {
                this.x = Math.random() * width; 
                this.y = -60; 
                this.speed = Math.random() * 2 + 3;
                this.emoji = Math.random() > 0.4 ? 'ðŸŒ¹' : 'ðŸ¤';
                this.type = this.emoji === 'ðŸŒ¹' ? 'good' : 'bad';
            }
            update() {
                this.y += this.speed;
                let bx = basket.offsetLeft;
                if (this.y > height - 140 && this.y < height - 60 && this.x > bx - 60 && this.x < bx + 60) {
                    if (this.type === 'good') { 
                        score++; 
                        document.getElementById('yay').currentTime = 0;
                        document.getElementById('yay').play().catch(()=>{});
                    } else { 
                        score = Math.max(0, score - 1); 
                        document.getElementById('neh').play().catch(()=>{});
                        document.body.classList.add('shake');
                        setTimeout(() => document.body.classList.remove('shake'), 400);
                    }
                    document.getElementById('score').innerText = score;
                    fill.style.width = (score / 20 * 100) + '%';
                    if (score >= 20) finish(); return false;
                }
                return this.y < height + 60;
            }
            draw() { 
                ctx.font = '40px serif';
                ctx.fillText(this.emoji, this.x - 20, this.y);
            }
        }

        function loop() {
            ctx.clearRect(0, 0, width, height);
            if (active) {
                if (Math.random() < 0.05) items.push(new Drop());
                items = items.filter(it => { it.draw(); return it.update(); });
                requestAnimationFrame(loop);
            }
        }

        function finish() { 
            active = false; 
            gameSfx.pause(); 
            document.getElementById('hud').style.opacity = '0'; 
            basket.style.opacity = '0'; 
            setTimeout(() => { document.getElementById('reveal-screen').style.display = 'flex'; }, 800); 
        }

        // --- THREE.JS SECTION ---
        let scene, camera, renderer, roseGroups = [], stars;

        function initThree() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x0a0510, 0.04);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('three-container').appendChild(renderer.domElement);

            const starGeo = new THREE.BufferGeometry();
            const starPoints = [];
            for(let i=0; i<800; i++) starPoints.push((Math.random()-0.5)*100, (Math.random()-0.5)*100, (Math.random()-0.5)*100);
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPoints, 3));
            stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.1}));
            scene.add(stars);

            const roseCanvas = document.createElement('canvas'); roseCanvas.width = 64; roseCanvas.height = 64;
            const rCtx = roseCanvas.getContext('2d'); rCtx.font = '50px serif'; rCtx.fillText('ðŸŒ¹', 5, 50);
            const roseTex = new THREE.CanvasTexture(roseCanvas);

            for(let i=0; i<100; i++) {
                const group = new THREE.Group();
                const stem = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 4), new THREE.MeshBasicMaterial({color: 0x1a4a1a}));
                group.add(stem);
                const head = new THREE.Sprite(new THREE.SpriteMaterial({map: roseTex}));
                head.position.y = 2.2; head.scale.set(1.5, 1.5, 1);
                group.add(head);
                group.position.set((Math.random()-0.5)*40, -10, (Math.random()-0.5)*30 - 10);
                scene.add(group);
                roseGroups.push({obj: group, targetY: -2, phase: Math.random()*10});
            }
            camera.position.z = 15;
        }

        async function bloom() {
            await initAudio();
            winSong.play().catch(()=>{});
            document.getElementById('reveal-screen').style.display = 'none';
            document.getElementById('three-container').style.display = 'block';
            initThree();
            animateThree();
            setTimeout(() => { document.getElementById('final-card').classList.add('show'); }, 4000);
        }

        function animateThree() {
            requestAnimationFrame(animateThree);
            roseGroups.forEach(r => {
                if(r.obj.position.y < r.targetY) r.obj.position.y += 0.05;
                r.obj.rotation.z = Math.sin(Date.now()*0.001 + r.phase)*0.1;
            });
            stars.rotation.y += 0.001;
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
