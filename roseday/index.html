<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dipin's Dreamy Garden</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Plus+Jakarta+Sans:wght@300;600&display=swap');
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #0a0510; color: white; font-family: 'Plus Jakarta Sans', sans-serif; touch-action: none; }
        #three-container { position: fixed; inset: 0; display: none; z-index: 10; background: radial-gradient(circle at center, #2d1b4e 0%, #000 100%); }
        
        .fade-in { animation: fadeIn 1.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #start-screen, #reveal-screen { 
            position: fixed; inset: 0; z-index: 1000; 
            background: radial-gradient(circle at bottom, #4c1d95 0%, #0a0510 100%);
            display: flex; flex-direction: column; items: center; justify-content: center; 
        }
        .cursive { font-family: 'Dancing Script', cursive; }
        
        #hud { 
            position: fixed; top: 20px; width: 100%; text-align: center; z-index: 500; 
            opacity: 0; pointer-events: none; transition: all 0.8s ease; 
        }
        .bar-bg { 
            width: 80%; max-width: 300px; height: 10px; background: rgba(255,255,255,0.1); 
            border-radius: 20px; margin: 10px auto; overflow: hidden;
            backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2);
        }
        #bar-fill { 
            width: 0%; height: 100%; background: linear-gradient(90deg, #f43f5e, #fb7185); 
            box-shadow: 0 0 20px #f43f5e; transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }

        #basket { 
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); 
            font-size: 4rem; z-index: 100; pointer-events: none; opacity: 0; 
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
            transition: opacity 0.5s;
        }

        /* Responsive Final Card */
        .final-card {
            position: fixed; bottom: 5%; left: 50%; transform: translate(-50%, 0) scale(0.9);
            background: rgba(15, 7, 32, 0.7); backdrop-filter: blur(15px);
            padding: 1.5rem; border-radius: 2rem; border: 1px solid rgba(251, 191, 36, 0.3);
            text-align: center; opacity: 0; transition: all 2s ease-out; z-index: 2000; 
            pointer-events: none; width: 90%; max-width: 400px;
            box-shadow: 0 0 50px rgba(244, 63, 94, 0.2);
        }
        .final-card.show { opacity: 1; transform: translate(-50%, 0) scale(1); }

        .user-pic { 
            width: 100px; height: 100px; object-fit: cover; border-radius: 50%; 
            border: 3px solid #fbbf24; margin: 0 auto 1rem; 
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4); 
        }

        #game-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 50; }

        .score-pop { animation: pop 0.3s ease; }
        @keyframes pop { 50% { transform: scale(1.2); color: #fb7185; } }
        
        .shake { animation: shake 0.4s linear; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>

    <audio id="gameSfx" loop preload="auto">
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSong" loop preload="auto">
        <source src="song.mp3" type="audio/mpeg">
    </audio>
    <audio id="yay" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3" type="audio/mpeg">
    </audio>
    <audio id="neh" preload="auto">
        <source src="https://gfxsounds.com/wp-content/uploads/2023/03/Beep-error.mp3" type="audio/mpeg">
    </audio>

    <div id="start-screen">
        <h1 class="cursive text-6xl md:text-8xl text-rose-200 mb-8 drop-shadow-lg text-center px-4">Dipin's Garden</h1>
        <p class="text-rose-300 mb-10 tracking-widest uppercase text-xs">A Little Surprise For You Kanxi</p>
        <button onclick="begin()" class="cursive text-2xl text-white bg-gradient-to-r from-rose-600 to-rose-400 px-10 py-3 rounded-full hover:scale-110 transition-all">Enter Garden</button>
    </div>

    <div id="reveal-screen" style="display:none;">
        <h2 class="cursive text-4xl md:text-6xl text-white mb-10 text-center px-6">You've caught my mutu</h2>
        <button onclick="bloom()" class="cursive text-3xl md:text-5xl text-white bg-gradient-to-r from-amber-600 to-yellow-500 px-12 py-4 rounded-full animate-bounce">Reveal The Garden</button>
    </div>

    <div id="hud">
        <div class="text-rose-100 text-3xl md:text-5xl cursive mb-2" id="score-wrapper"><span id="score">0</span> / 20</div>
        <div class="bar-bg"><div id="bar-fill"></div></div>
    </div>

    <div id="basket">ðŸ§º</div>
    <canvas id="game-canvas"></canvas>
    <div id="three-container"></div>

    <div id="final-card" class="final-card">
        <img src="rose.JPG" class="user-pic" alt="Budi">
        <h1 class="cursive text-3xl md:text-5xl text-rose-100 mb-2">Happy Rose Day, Budi</h1>
        <div class="w-16 h-0.5 bg-rose-500 mx-auto mb-3 rounded-full"></div>
        <p class="text-rose-100 text-sm md:text-lg italic leading-relaxed">
            "Real ma rose dina napayani mailey yo sundar bagaicha banako xu, happy rose day sanu!"
        </p>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const basket = document.getElementById('basket');
        const fill = document.getElementById('bar-fill');
        const scoreWrap = document.getElementById('score-wrapper');
        const gameSfx = document.getElementById('gameSfx');
        const winSong = document.getElementById('winSong');
        
        let audioContext;
        let width, height, score = 0, active = false, items = [], mouseX = 0, mouseY = 0;

        function resize() { 
            width = canvas.width = window.innerWidth; 
            height = canvas.height = window.innerHeight; 
        }
        window.addEventListener('resize', resize); resize();

        async function initAudio() {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            if (audioContext.state === 'suspended') await audioContext.resume();
        }

        async function begin() {
            await initAudio();
            document.getElementById('start-screen').style.display = 'none';
            gameSfx.play().catch(e => console.log("Audio blocked"));
            document.getElementById('hud').style.opacity = '1';
            basket.style.opacity = '1';
            active = true;
            loop();
        }

        class Drop {
            constructor() {
                this.x = Math.random() * width; 
                this.y = -60; 
                this.speed = Math.random() * 2 + 3;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotSpeed = (Math.random() - 0.5) * 0.1;
                const r = Math.random(); 
                this.emoji = r > 0.45 ? 'ðŸŒ¹' : 'ðŸ¤';
                this.type = r > 0.45 ? 'good' : 'bad';
            }
            update() {
                this.y += this.speed;
                this.rotation += this.rotSpeed;
                this.x += Math.sin(this.y / 50) * 1.5;

                let bx = basket.offsetLeft;
                if (this.y > height - 120 && this.y < height - 40 && this.x > bx - 60 && this.x < bx + 60) {
                    if (this.type === 'good') { 
                        score++; 
                        document.getElementById('yay').play().catch(()=>{});
                        scoreWrap.classList.remove('score-pop');
                        void scoreWrap.offsetWidth;
                        scoreWrap.classList.add('score-pop');
                    } else { 
                        score = Math.max(0, score - 1); 
                        document.getElementById('neh').play().catch(()=>{});
                        document.body.classList.add('shake');
                        setTimeout(() => document.body.classList.remove('shake'), 400);
                    }
                    document.getElementById('score').innerText = score;
                    fill.style.width = (score / 20 * 100) + '%';
                    if (score >= 20) finish(); return false;
                }
                return this.y < height + 60;
            }
            draw() { 
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.font = '40px serif'; 
                ctx.fillText(this.emoji, -20, 20);
                ctx.restore();
            }
        }

        function finish() { 
            active = false; 
            gameSfx.pause(); 
            document.getElementById('hud').style.opacity = '0'; 
            basket.style.opacity = '0'; 
            setTimeout(() => { document.getElementById('reveal-screen').style.display = 'flex'; }, 800); 
        }

        // CONTROL HANDLERS (Mouse + Touch)
        function handleMove(e) {
            let clientX = e.touches ? e.touches[0].clientX : e.clientX;
            let clientY = e.touches ? e.touches[0].clientY : e.clientY;
            mouseX = clientX; mouseY = clientY;
            if (active) {
                const targetX = clientX;
                const currentX = parseFloat(basket.style.left) || width/2;
                basket.style.left = targetX + 'px';
                basket.style.transform = `translateX(-50%) rotate(${(targetX - currentX) * 0.5}deg)`;
            }
        }
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('touchmove', handleMove, { passive: false });

        // THREE JS LOGIC
        let scene, camera, renderer, roseGroups = [], butterflies = [], stars;
        function initThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('three-container').appendChild(renderer.domElement);

            const starGeo = new THREE.BufferGeometry();
            const starPoints = [];
            for(let i=0; i<800; i++) starPoints.push((Math.random()-0.5)*100, (Math.random()-0.5)*100, (Math.random()-0.5)*100);
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPoints, 3));
            stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.1}));
            scene.add(stars);

            const roseCanvas = document.createElement('canvas'); roseCanvas.width = 64; roseCanvas.height = 64;
            const rCtx = roseCanvas.getContext('2d'); rCtx.font = '50px serif'; rCtx.fillText('ðŸŒ¹', 5, 50);
            const roseTex = new THREE.CanvasTexture(roseCanvas);

            for(let i=0; i<100; i++) {
                const group = new THREE.Group();
                const stemH = Math.random() * 3 + 2;
                const head = new THREE.Sprite(new THREE.SpriteMaterial({map: roseTex}));
                head.position.y = stemH; head.scale.set(1.5, 1.5, 1);
                group.add(head);
                group.position.set((Math.random()-0.5)*40, -10, (Math.random()-0.5)*30 - 10);
                scene.add(group);
                roseGroups.push({obj: group, targetY: -4, phase: Math.random() * 10});
            }
            camera.position.set(0, 5, 15);
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        }

        async function bloom() {
            await initAudio();
            winSong.play();
            document.getElementById('reveal-screen').style.display = 'none';
            document.getElementById('three-container').style.display = 'block';
            initThree();
            animateThree();
            setTimeout(() => { document.getElementById('final-card').classList.add('show'); }, 3000);
        }

        function animateThree() {
            requestAnimationFrame(animateThree);
            stars.rotation.y += 0.001;
            roseGroups.forEach(r => {
                if(r.obj.position.y < r.targetY) r.obj.position.y += 0.05;
                r.obj.rotation.z = Math.sin(Date.now() * 0.001 + r.phase) * 0.1;
            });
            renderer.render(scene, camera);
        }

        function loop() {
            ctx.clearRect(0, 0, width, height);
            if (active) {
                if (Math.random() < 0.05) items.push(new Drop());
                items = items.filter(it => { it.draw(); return it.update(); });
                requestAnimationFrame(loop);
            }
        }
    </script>
</body>
</html>
